<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidu-aiè§†é¢‘æŠ½å¡ç§¯åˆ†æ¶ˆè€—è®¡ç®—å¹³å°-æ˜“ä¸“å±ä½¿ç”¨</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ä¸ƒå½©é«˜æ–¯æ¨¡ç³ŠèƒŒæ™¯åŠ¨ç”» */
        body { 
            background-color: #050505;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* å®šä¹‰æå…‰/å…¨æ¯è‰²åŠ¨ç”» */
        @keyframes aurora-1 {
            0%, 100% { top: -10%; left: -10%; transform: rotate(0deg) scale(1); }
            50% { top: 20%; left: 10%; transform: rotate(120deg) scale(1.2); }
        }
        @keyframes aurora-2 {
            0%, 100% { bottom: -10%; right: -10%; transform: rotate(0deg) scale(1); }
            50% { bottom: 10%; right: 10%; transform: rotate(-120deg) scale(1.1); }
        }
        @keyframes aurora-3 {
            0%, 100% { top: 40%; right: 20%; transform: translate(0, 0) scale(1); }
            50% { top: 60%; right: 40%; transform: translate(-30px, 30px) scale(0.9); }
        }

        /* æ¨¡æ€æ¡†è¿›å‡ºåŠ¨ç”» */
        @keyframes modal-pop {
            0% { opacity: 0; transform: scale(0.95) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* æŠ½å¡åŠ¨ç”» */
        @keyframes gacha-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes gacha-flash {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* æŠ½è±¡æ–‡å­—æµ®åŠ¨åŠ¨ç”» */
        @keyframes abstract-float {
            0%, 100% { transform: translate(-50%, -50%) rotate(-2deg); }
            50% { transform: translate(-50%, -55%) rotate(2deg); }
        }

        /* å±é™©é¡µé¢éœ‡åŠ¨åŠ¨ç”» */
        @keyframes extreme-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); }
        
        /* å¼ºåˆ¶æ—¥æœŸå›¾æ ‡ç™½è‰² */
        ::-webkit-calendar-picker-indicator { filter: invert(1); opacity: 0.6; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 1. å›¾æ ‡ç»„ä»¶ ---
        const IconWrapper = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Zap = ({ className }) => <IconWrapper className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconWrapper>;
        const TrendingDown = ({ className }) => <IconWrapper className={className}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></IconWrapper>;
        const Target = ({ className }) => <IconWrapper className={className}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></IconWrapper>;
        const BarChart2 = ({ className }) => <IconWrapper className={className}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></IconWrapper>;
        const AlertTriangle = ({ className }) => <IconWrapper className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconWrapper>;
        const PlusCircle = ({ className }) => <IconWrapper className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></IconWrapper>;
        const Save = ({ className }) => <IconWrapper className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconWrapper>;
        const History = ({ className }) => <IconWrapper className={className}><path d="M3 3v5h5"></path><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path></IconWrapper>;
        const Trash2 = ({ className }) => <IconWrapper className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconWrapper>;
        const Users = ({ className }) => <IconWrapper className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></IconWrapper>;
        const Edit2 = ({ className }) => <IconWrapper className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></IconWrapper>;
        const X = ({ className }) => <IconWrapper className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconWrapper>;
        const Download = ({ className }) => <IconWrapper className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></IconWrapper>;
        const ChevronRight = ({ className }) => <IconWrapper className={className}><polyline points="9 18 15 12 9 6"></polyline></IconWrapper>;
        const Gamepad2 = ({ className }) => <IconWrapper className={className}><line x1="6" y1="12" x2="10" y2="12"></line><line x1="8" y1="10" x2="8" y2="14"></line><line x1="15" y1="13" x2="15.01" y2="13"></line><line x1="18" y1="11" x2="18.01" y2="11"></line><rect x="2" y="6" width="20" height="12" rx="2"></rect></IconWrapper>;
        const Flame = ({ className }) => <IconWrapper className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></IconWrapper>;
        const Clapperboard = ({ className }) => <IconWrapper className={className}><rect x="2" y="6" width="20" height="12" rx="2" /><path d="M2 12h20" /><path d="M6 6v6" /><path d="M12 6v6" /><path d="M18 6v6" /></IconWrapper>;

        // --- 2. åŸºç¡€ UI ç»„ä»¶ (ä¸ƒå½©é«˜æ–¯é£) ---
        
        const Card = ({ children, className = "", onClick }) => (
            <div 
                onClick={onClick}
                className={`relative backdrop-blur-2xl bg-white/5 border border-white/10 rounded-2xl p-6 shadow-[0_8px_32px_rgba(0,0,0,0.3)] overflow-hidden group transition-all duration-300 ${onClick ? 'cursor-pointer hover:bg-white/10 hover:border-white/20 hover:scale-[1.01] hover:shadow-[0_15px_40px_rgba(0,0,0,0.4)]' : ''} ${className}`}
            >
                <div className="absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                <div className="relative z-10">
                    {children}
                </div>
            </div>
        );

        const Badge = ({ children, type = "neutral" }) => {
            const styles = {
                neutral: "bg-white/5 text-white/60 border-white/10",
                success: "bg-emerald-500/10 text-emerald-300 border-emerald-500/20 shadow-[0_0_10px_rgba(16,185,129,0.1)]",
                danger: "bg-rose-500/10 text-rose-300 border-rose-500/20 shadow-[0_0_10px_rgba(244,63,94,0.1)]",
                warning: "bg-amber-500/10 text-amber-300 border-amber-500/20",
                legendary: "bg-yellow-500/20 text-yellow-200 border-yellow-500/30 shadow-[0_0_15px_rgba(234,179,8,0.4)]",
                script: "bg-indigo-500/20 text-indigo-200 border-indigo-500/30"
            };
            return (
                <span className={`px-2.5 py-1 rounded-full border text-[10px] font-bold uppercase tracking-wider ${styles[type] || styles.neutral}`}>
                {children}
                </span>
            );
        };

        // --- 3. æ¸¸æˆæ¨¡æ€æ¡† (Neural Gacha Game) ---
        const GameModal = ({ onClose }) => {
            const [isRolling, setIsRolling] = useState(false);
            const [result, setResult] = useState(null);
            const [inventory, setInventory] = useState(() => {
                const saved = localStorage.getItem('vidu_game_inventory');
                return saved ? JSON.parse(saved) : { common: 0, rare: 0, epic: 0, legendary: 0 };
            });

            useEffect(() => {
                localStorage.setItem('vidu_game_inventory', JSON.stringify(inventory));
            }, [inventory]);

            const roll = () => {
                if(isRolling) return;
                setIsRolling(true);
                setResult(null);

                setTimeout(() => {
                    const rand = Math.random() * 100;
                    let type = 'common';
                    let text = 'Glitch Mess (åºŸç‰‡)';
                    
                    if (rand > 95) { type = 'legendary'; text = 'Vidu Masterpiece (ç¥ä½œ)'; }
                    else if (rand > 85) { type = 'epic'; text = 'Viral Clip (çˆ†æ¬¾)'; }
                    else if (rand > 55) { type = 'rare'; text = 'Standard Shot (æ ‡å‡†)'; }

                    setInventory(prev => ({...prev, [type]: prev[type] + 1}));
                    setResult({ type, text });
                    setIsRolling(false);
                }, 1000); // 1ç§’ç”ŸæˆåŠ¨ç”»æ¨¡æ‹Ÿ
            };

            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-[fadeIn_0.2s_ease-out]" onClick={onClose}>
                    <div className="bg-[#0f111a] border border-cyan-500/30 rounded-2xl w-full max-w-sm shadow-[0_0_50px_rgba(168,85,247,0.2)] animate-[modal-pop_0.3s_cubic-bezier(0.34,1.56,0.64,1)] overflow-hidden" onClick={e => e.stopPropagation()}>
                        <div className="p-6 text-center">
                            <h3 className="text-2xl font-black italic bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-400 mb-2">NEURAL GACHA</h3>
                            <p className="text-xs text-white/40 mb-6">Simulate AI Generation (æ‘¸é±¼æ¨¡æ‹Ÿå™¨)</p>
                            
                            {/* ç»“æœæ˜¾ç¤ºåŒº */}
                            <div className="h-32 flex items-center justify-center mb-6 bg-black/40 rounded-xl border border-white/5 relative overflow-hidden">
                                {isRolling ? (
                                    <div className="w-8 h-8 border-4 border-cyan-500/30 border-t-cyan-400 rounded-full animate-spin"></div>
                                ) : result ? (
                                    <div className={`animate-[gacha-flash_0.5s_ease-out] flex flex-col items-center gap-2 ${
                                        result.type === 'legendary' ? 'text-yellow-300 drop-shadow-[0_0_10px_rgba(234,179,8,0.8)]' :
                                        result.type === 'epic' ? 'text-purple-300 drop-shadow-[0_0_10px_rgba(168,85,247,0.6)]' :
                                        result.type === 'rare' ? 'text-cyan-300' : 'text-slate-400'
                                    }`}>
                                        <span className="text-3xl">
                                            {result.type === 'legendary' ? 'ğŸ‘‘' : result.type === 'epic' ? 'ğŸŒŸ' : result.type === 'rare' ? 'âœ¨' : 'ğŸ—‘'}
                                        </span>
                                        <span className="font-bold text-lg">{result.text}</span>
                                    </div>
                                ) : (
                                    <span className="text-white/20 text-xs">Ready to Generate</span>
                                )}
                            </div>

                            <button 
                                onClick={roll}
                                disabled={isRolling}
                                className={`w-full py-4 rounded-xl font-black text-lg tracking-widest uppercase transition-all ${
                                    isRolling ? 'bg-slate-700 text-slate-500 cursor-not-allowed' : 
                                    'bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500 text-white shadow-[0_0_20px_rgba(168,85,247,0.4)] active:scale-95'
                                }`}
                            >
                                {isRolling ? 'GENERATING...' : 'GENERATE (10pts)'}
                            </button>

                            {/* ä»“åº“ç»Ÿè®¡ */}
                            <div className="mt-6 grid grid-cols-4 gap-2 text-center">
                                <div className="p-2 bg-white/5 rounded border border-white/5">
                                    <div className="text-[10px] text-yellow-500 font-bold">SSR</div>
                                    <div className="font-mono text-white">{inventory.legendary}</div>
                                </div>
                                <div className="p-2 bg-white/5 rounded border border-white/5">
                                    <div className="text-[10px] text-purple-400 font-bold">SR</div>
                                    <div className="font-mono text-white">{inventory.epic}</div>
                                </div>
                                <div className="p-2 bg-white/5 rounded border border-white/5">
                                    <div className="text-[10px] text-cyan-400 font-bold">R</div>
                                    <div className="font-mono text-white">{inventory.rare}</div>
                                </div>
                                <div className="p-2 bg-white/5 rounded border border-white/5">
                                    <div className="text-[10px] text-slate-500 font-bold">N</div>
                                    <div className="font-mono text-white">{inventory.common}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 4. è¯¦æƒ…æ¨¡æ€æ¡† ---
        const DetailModal = ({ title, type, data, onClose, baseEfficiency }) => {
            const validRecords = data.filter(r => r.type === 'normal');

            const renderContent = () => {
                switch(type) {
                    case 'consumption':
                        return (
                            <div className="space-y-4">
                                <div className="text-xs text-white/50 mb-2">ç®—åŠ›æ¶ˆè€—æ—¥å¿— (Shared Cost)</div>
                                <div className="max-h-[60vh] overflow-y-auto pr-2 space-y-2">
                                    {validRecords.map(r => (
                                        <div key={r.id} className="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/5">
                                            <div className="flex flex-col">
                                                <span className="text-sm font-mono text-white/70">{r.date}</span>
                                                {r.scriptName && <span className="text-[10px] text-indigo-300">ğŸ¬ {r.scriptName}</span>}
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <div className="w-24 h-1.5 bg-white/10 rounded-full overflow-hidden">
                                                    <div className="h-full bg-gradient-to-r from-blue-500 to-purple-500" style={{width: `${Math.min((r.consumed/3000)*100, 100)}%`}}></div>
                                                </div>
                                                <span className="font-mono font-bold w-12 text-right">{r.consumed}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    case 'shots':
                        return (
                            <div className="space-y-4">
                                <div className="text-xs text-white/50 mb-2 flex justify-between">
                                    <span>æ¯æ—¥äº§å‡ºå¯¹æ¯”</span>
                                    <span className="flex gap-2">
                                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-cyan-400"></span>æˆ‘</span>
                                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-pink-400"></span>é˜Ÿå‹</span>
                                    </span>
                                </div>
                                <div className="max-h-[60vh] overflow-y-auto pr-2 space-y-3">
                                    {validRecords.map(r => {
                                        const my = r.myShots || 0;
                                        const pt = r.partnerShots || 0;
                                        const total = my + pt;
                                        return (
                                            <div key={r.id} className="p-3 bg-white/5 rounded-lg border border-white/5">
                                                <div className="flex justify-between items-center mb-2">
                                                    <div className="flex flex-col">
                                                        <span className="text-xs font-mono text-white/70">{r.date}</span>
                                                        {r.scriptName && <span className="text-[10px] text-indigo-300">ğŸ¬ {r.scriptName}</span>}
                                                    </div>
                                                    <span className="text-xs font-bold text-white">Total: {r.shots}</span>
                                                </div>
                                                <div className="flex items-center gap-2 h-6">
                                                    <div className="h-full bg-cyan-500/40 rounded-l flex items-center justify-center text-[10px] relative min-w-[20px]" style={{width: `${(my/total)*100}%`}}>
                                                        {my > 0 && <span className="absolute z-10 text-white shadow-black drop-shadow-md">{my}</span>}
                                                    </div>
                                                    <div className="h-full bg-pink-500/40 rounded-r flex items-center justify-center text-[10px] relative min-w-[20px]" style={{width: `${(pt/total)*100}%`}}>
                                                        {pt > 0 && <span className="absolute z-10 text-white shadow-black drop-shadow-md">{pt}</span>}
                                                    </div>
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        );
                    case 'cpr':
                        return (
                            <div className="space-y-4">
                                <div className="text-xs text-white/50 mb-2">CPR æ•ˆç‡è¶‹åŠ¿ (è¶Šä½è¶Šå¥½)</div>
                                <div className="max-h-[60vh] overflow-y-auto pr-2 space-y-2">
                                    {validRecords.map(r => {
                                        const cprVal = parseFloat(r.cpr);
                                        const isBad = cprVal > baseEfficiency;
                                        return (
                                            <div key={r.id} className="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/5">
                                                <div className="flex flex-col">
                                                    <span className="text-sm font-mono text-white/70">{r.date}</span>
                                                    {r.scriptName && <span className="text-[10px] text-indigo-300">ğŸ¬ {r.scriptName}</span>}
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className={`text-xs px-2 py-0.5 rounded ${isBad ? 'bg-rose-500/20 text-rose-300' : 'bg-emerald-500/20 text-emerald-300'}`}>
                                                        {isBad ? 'åé«˜' : 'ä¼˜ç§€'}
                                                    </span>
                                                    <span className={`font-mono font-bold w-16 text-right ${isBad ? 'text-rose-400' : 'text-emerald-400'}`}>{r.cpr}</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        );
                    case 'inefficiency':
                        const badDays = validRecords.filter(r => r.isInefficient);
                        return (
                            <div className="space-y-4">
                                <div className="text-xs text-white/50 mb-2">ä½æ•ˆè­¦å‘Šè®°å½• ({badDays.length})</div>
                                {badDays.length === 0 ? (
                                    <div className="py-10 text-center text-emerald-400/50">
                                        æš‚æ— å¼‚å¸¸ï¼Œé…åˆå®Œç¾ï¼
                                    </div>
                                ) : (
                                    <div className="max-h-[60vh] overflow-y-auto pr-2 space-y-2">
                                        {badDays.map(r => (
                                            <div key={r.id} className="p-3 bg-rose-500/10 rounded-lg border border-rose-500/20 flex flex-col gap-2">
                                                <div className="flex justify-between">
                                                    <div className="flex flex-col">
                                                        <span className="font-mono text-rose-200">{r.date}</span>
                                                        {r.scriptName && <span className="text-[10px] text-rose-300/80">ğŸ¬ {r.scriptName}</span>}
                                                    </div>
                                                    <span className="text-xs bg-rose-500 text-white px-1.5 rounded h-fit">WARN</span>
                                                </div>
                                                <div className="flex justify-between text-xs text-rose-300/70">
                                                    <span>æ¶ˆè€—: {r.consumed}</span>
                                                    <span>äº§å‡º: {r.shots}</span>
                                                    <span>CPR: {r.cpr}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        );
                    case 'scripts':
                        // å‰§æœ¬æ•°æ®èšåˆé€»è¾‘
                        const scriptStats = validRecords.reduce((acc, r) => {
                            const name = r.scriptName || 'Unknown';
                            if (!acc[name]) acc[name] = { cost: 0, shots: 0, count: 0 };
                            acc[name].cost += r.consumed;
                            acc[name].shots += r.shots;
                            acc[name].count += 1;
                            return acc;
                        }, {});
                        const scriptList = Object.entries(scriptStats);
                        
                        return (
                            <div className="space-y-4">
                                <div className="text-xs text-white/50 mb-2">å‰§æœ¬æ•ˆç›Šåˆ†æ</div>
                                {scriptList.length === 0 ? (
                                    <div className="py-10 text-center text-white/30">æš‚æ— å‰§æœ¬è®°å½•</div>
                                ) : (
                                    <div className="max-h-[60vh] overflow-y-auto pr-2 space-y-3">
                                        {scriptList.map(([name, data]) => {
                                            const avgCpr = data.shots > 0 ? (data.cost / data.shots).toFixed(1) : 0;
                                            return (
                                                <div key={name} className="p-3 bg-white/5 rounded-lg border border-white/5">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <div className="flex items-center gap-2">
                                                            <Clapperboard className="w-4 h-4 text-indigo-400" />
                                                            <span className="font-bold text-white">{name}</span>
                                                        </div>
                                                        <span className="text-xs text-white/40">{data.count} å¤©è®°å½•</span>
                                                    </div>
                                                    <div className="grid grid-cols-3 gap-2 text-center text-xs">
                                                        <div className="p-2 bg-white/5 rounded">
                                                            <div className="text-white/40 mb-1">æ€»æ¶ˆè€—</div>
                                                            <div className="font-mono text-white">{data.cost}</div>
                                                        </div>
                                                        <div className="p-2 bg-white/5 rounded">
                                                            <div className="text-white/40 mb-1">æ€»äº§å‡º</div>
                                                            <div className="font-mono text-cyan-300">{data.shots}</div>
                                                        </div>
                                                        <div className={`p-2 rounded ${parseFloat(avgCpr) > baseEfficiency ? 'bg-rose-500/10' : 'bg-emerald-500/10'}`}>
                                                            <div className="text-white/40 mb-1">å¹³å‡CPR</div>
                                                            <div className={`font-mono font-bold ${parseFloat(avgCpr) > baseEfficiency ? 'text-rose-400' : 'text-emerald-400'}`}>{avgCpr}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        );
                    default: return null;
                }
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-[fadeIn_0.2s_ease-out]" onClick={onClose}>
                    <div className="bg-[#0a0a0a]/90 border border-white/20 rounded-2xl w-full max-w-lg shadow-2xl animate-[modal-pop_0.3s_ease-out] overflow-hidden" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center p-5 border-b border-white/10 bg-white/5">
                            <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                {title}
                            </h3>
                            <button onClick={onClose} className="p-1 hover:bg-white/10 rounded-full transition-colors"><X className="w-5 h-5 text-white/60" /></button>
                        </div>
                        <div className="p-5">
                            {renderContent()}
                        </div>
                    </div>
                </div>
            );
        };

        // ç¼–è¾‘æ¨¡æ€æ¡† (ä¿æŒä¸å˜)
        const EditModal = ({ record, onClose, onSave, baseEfficiency }) => {
            const [formData, setFormData] = useState({
                date: record.timestamp.split('T')[0],
                remaining: record.remaining,
                consumed: record.consumed,
                myShots: record.myShots || 0,
                partnerShots: record.partnerShots || 0,
                scriptName: record.scriptName || '',
                type: record.type
            });

            const totalShots = parseInt(formData.myShots || 0) + parseInt(formData.partnerShots || 0);
            const currentCPR = totalShots > 0 ? (formData.consumed / totalShots).toFixed(1) : 0;
            const isInefficient = formData.type === 'normal' && formData.consumed > 1000 && (totalShots === 0 || parseFloat(currentCPR) > baseEfficiency);

            const handleChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));

            const handleSave = () => {
                onSave({
                    ...record,
                    date: formData.date.replace(/-/g, '/'),
                    timestamp: new Date(formData.date).toISOString(),
                    remaining: parseInt(formData.remaining),
                    consumed: parseInt(formData.consumed),
                    myShots: parseInt(formData.myShots),
                    partnerShots: parseInt(formData.partnerShots),
                    scriptName: formData.scriptName,
                    shots: totalShots,
                    type: formData.type,
                    cpr: currentCPR,
                    isInefficient: isInefficient
                });
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-[fadeIn_0.2s_ease-out]">
                    <div className="bg-[#0f111a] border border-cyan-500/30 rounded-2xl w-full max-w-md shadow-[0_0_50px_rgba(6,182,212,0.15)] animate-[modal-in_0.3s_cubic-bezier(0.34,1.56,0.64,1)] overflow-hidden">
                        <div className="flex justify-between items-center p-5 border-b border-white/10 bg-gradient-to-r from-cyan-900/20 to-transparent">
                            <h3 className="text-xl font-bold text-white flex items-center gap-2"><Edit2 className="w-5 h-5 text-cyan-400" /> Modify Record</h3>
                            <button onClick={onClose}><X className="w-6 h-6 text-white/40 hover:text-white" /></button>
                        </div>
                        <div className="p-6 space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Date</label><input type="date" value={formData.date} onChange={e => handleChange('date', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-cyan-500/50 outline-none" /></div>
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Type</label><select value={formData.type} onChange={e => handleChange('type', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-cyan-500/50 outline-none appearance-none"><option value="normal">Normal</option><option value="topup">Recharge</option><option value="initial">Initial</option></select></div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Balance</label><input type="number" value={formData.remaining} onChange={e => handleChange('remaining', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm font-mono focus:border-cyan-500/50 outline-none" /></div>
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Cost</label><input type="number" value={formData.consumed} onChange={e => handleChange('consumed', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm font-mono focus:border-cyan-500/50 outline-none" /></div>
                            </div>
                            {/* å‰§æœ¬åç§°ç¼–è¾‘ */}
                            <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Script Name</label><input type="text" value={formData.scriptName} onChange={e => handleChange('scriptName', e.target.value)} placeholder="Enter Script Name..." className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-cyan-500/50 outline-none" /></div>
                            <div className="grid grid-cols-2 gap-4 pt-2 border-t border-white/5">
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">My Shots</label><input type="number" value={formData.myShots} onChange={e => handleChange('myShots', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm font-mono focus:border-cyan-500/50 outline-none" /></div>
                                <div><label className="text-[10px] font-bold text-cyan-200/40 uppercase">Partner</label><input type="number" value={formData.partnerShots} onChange={e => handleChange('partnerShots', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-white text-sm font-mono focus:border-cyan-500/50 outline-none" /></div>
                            </div>
                            <div className={`mt-2 p-3 rounded-lg border flex justify-between items-center text-xs ${isInefficient ? 'bg-rose-950/20 border-rose-500/20' : 'bg-emerald-950/20 border-emerald-500/20'}`}>
                                <div><span className="opacity-50 block uppercase text-[10px]">Total</span><span className="font-mono font-bold text-lg">{totalShots}</span></div>
                                <div className="text-right"><span className="opacity-50 block uppercase text-[10px]">CPR</span><span className={`font-mono font-bold text-lg ${parseFloat(currentCPR) > baseEfficiency ? 'text-rose-400' : 'text-emerald-400'}`}>{currentCPR}</span></div>
                            </div>
                        </div>
                        <div className="p-5 border-t border-white/10 flex gap-3">
                            <button onClick={onClose} className="flex-1 py-3 rounded-lg bg-white/5 hover:bg-white/10 text-sm font-bold text-slate-300">Cancel</button>
                            <button onClick={handleSave} className="flex-1 py-3 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-sm font-bold text-white shadow-[0_0_15px_-3px_rgba(8,145,178,0.5)]">Save Changes</button>
                        </div>
                    </div>
                </div>
            );
        };

        function App() {
            const [records, setRecords] = useState([]);
            const [dateStr, setDateStr] = useState(() => new Date().toISOString().split('T')[0]);
            const [remainingPoints, setRemainingPoints] = useState('');
            const [myShots, setMyShots] = useState('');
            const [partnerShots, setPartnerShots] = useState('');
            const [scriptName, setScriptName] = useState(''); // æ–°å¢å‰§æœ¬åå­—çŠ¶æ€
            const [isTopUp, setIsTopUp] = useState(false);
            const [showDanger, setShowDanger] = useState(false); // å±é™©é¡µé¢çŠ¶æ€
            
            const [editingRecord, setEditingRecord] = useState(null);
            const [activeDetail, setActiveDetail] = useState(null);
            const [showGame, setShowGame] = useState(false);
            
            const [baseEfficiency, setBaseEfficiency] = useState(60); 
            const [triggerThreshold, setTriggerThreshold] = useState(1000);

            useEffect(() => {
                const saved = localStorage.getItem('render_tracker_data');
                if (saved) {
                    try { setRecords(JSON.parse(saved)); } catch (e) { console.error("Failed to load", e); }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('render_tracker_data', JSON.stringify(records));
            }, [records]);

            const lastRecord = records.length > 0 ? records[0] : null;
            const totalShots = (parseInt(myShots) || 0) + (parseInt(partnerShots) || 0);

            // è¿èƒœè®¡ç®—é€»è¾‘ (Gamification)
            const efficiencyStreak = useMemo(() => {
                let streak = 0;
                // ä»æœ€è¿‘çš„è®°å½•å¼€å§‹å€’åºæ£€æŸ¥
                // ä»…è®¡ç®— type='normal' çš„è®°å½•
                for (const r of records) {
                    if (r.type === 'normal') {
                        if (!r.isInefficient) {
                            streak++;
                        } else {
                            break; // é‡åˆ°ä¸€æ¬¡ä½æ•ˆå°±ä¸­æ–­
                        }
                    }
                }
                return streak;
            }, [records]);

            const handleAdd = () => {
                if (!remainingPoints) return;
                const currentPoints = parseInt(remainingPoints);
                const shots = totalShots; 
                const displayDate = dateStr.replace(/-/g, '/');
                
                let consumed = 0;
                let type = 'normal';

                if (!lastRecord) {
                    type = 'initial';
                    consumed = 0;
                } else if (isTopUp) {
                    type = 'topup';
                    consumed = 0;
                } else {
                    consumed = lastRecord.remaining - currentPoints;
                }

                const currentCPR = shots > 0 ? (consumed / shots) : 0;
                const isInefficient = type === 'normal' && consumed > triggerThreshold && (shots === 0 || currentCPR > baseEfficiency);

                const newRecord = {
                    id: Date.now(),
                    date: displayDate,
                    timestamp: new Date(dateStr).toISOString(),
                    remaining: currentPoints,
                    consumed: consumed,
                    shots: shots,
                    myShots: parseInt(myShots) || 0,
                    partnerShots: parseInt(partnerShots) || 0,
                    scriptName: scriptName, // ä¿å­˜å‰§æœ¬å
                    type: type,
                    isInefficient: isInefficient,
                    cpr: currentCPR.toFixed(1)
                };
                setRecords([newRecord, ...records]);
                setRemainingPoints('');
                setMyShots('');
                setPartnerShots('');
                setScriptName(''); // æ¸…ç©ºå‰§æœ¬åè¾“å…¥
                setIsTopUp(false);
            };

            const handleDelete = (id) => setRecords(records.filter(r => r.id !== id));
            
            const handleUpdateRecord = (updatedRecord) => {
                setRecords(records.map(r => r.id === updatedRecord.id ? updatedRecord : r));
                setEditingRecord(null);
            };

            const clearAll = () => {
                if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™æ“ä½œä¸å¯é€†å•Šå“¥ä»¬ã€‚")) setRecords([]);
            };

            const exportData = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(records));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "vidu_tracker_data.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const stats = useMemo(() => {
                const normalRecords = records.filter(r => r.type === 'normal');
                const totalConsumed = normalRecords.reduce((acc, curr) => acc + curr.consumed, 0);
                const totalShots = normalRecords.reduce((acc, curr) => acc + curr.shots, 0);
                const avgCPR = totalShots > 0 ? (totalConsumed / totalShots).toFixed(1) : 0;
                const inefficiencyCount = records.filter(r => r.isInefficient).length;
                
                // è®¡ç®—æ´»è·ƒå‰§æœ¬æ•° (ç®€å•çš„å»é‡)
                const uniqueScripts = new Set(normalRecords.map(r => r.scriptName).filter(Boolean)).size;
                
                return { totalConsumed, totalShots, avgCPR, inefficiencyCount, uniqueScripts };
            }, [records]);

            const previewConsumption = lastRecord && !isTopUp && remainingPoints 
                ? (lastRecord.remaining - parseInt(remainingPoints)) 
                : null;

            const previewCPR = (!isTopUp && previewConsumption && totalShots > 0) 
                ? (previewConsumption / totalShots).toFixed(1) 
                : null;

            // --- æ¸²æŸ“éƒ¨åˆ† ---
            return (
                <div className="min-h-screen relative p-4 md:p-8 font-sans selection:bg-pink-500/30 selection:text-white">
                    
                    {/* --- ä¸ƒå½©é«˜æ–¯æ¨¡ç³ŠèƒŒæ™¯å±‚ --- */}
                    <div className="fixed inset-0 -z-10 pointer-events-none bg-[#050505] overflow-hidden">
                        <div className="absolute w-[60vw] h-[60vw] bg-purple-600/20 rounded-full blur-[120px] mix-blend-screen animate-[aurora-1_15s_infinite_alternate]"></div>
                        <div className="absolute w-[50vw] h-[50vw] bg-cyan-500/20 rounded-full blur-[100px] mix-blend-screen animate-[aurora-2_20s_infinite_alternate]"></div>
                        <div className="absolute w-[40vw] h-[40vw] bg-pink-500/20 rounded-full blur-[90px] mix-blend-screen animate-[aurora-3_12s_infinite_alternate]"></div>
                        <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 mix-blend-overlay"></div>
                    </div>

                    {/* å±é™©é¡µé¢ Overlay */}
                    {showDanger && (
                      <div 
                        className="fixed inset-0 z-[100] bg-red-600 flex items-center justify-center cursor-pointer animate-[extreme-shake_0.5s_infinite]"
                        onClick={() => setShowDanger(false)}
                      >
                        <div className="flex flex-col items-center gap-12">
                           <h1 className="text-[15rem] md:text-[20rem] font-black text-black leading-none select-none flex flex-col items-center drop-shadow-[10px_10px_0_rgba(255,255,255,0.2)]">
                             <span>å¿«</span>
                             <span>è·‘</span>
                           </h1>
                        </div>
                      </div>
                    )}

                    {/* æ¨¡æ€æ¡† */}
                    {showGame && <GameModal onClose={() => setShowGame(false)} />}
                    {editingRecord && (
                        <EditModal record={editingRecord} onClose={() => setEditingRecord(null)} onSave={handleUpdateRecord} baseEfficiency={baseEfficiency} />
                    )}
                    {activeDetail && (
                        <DetailModal 
                            title={
                                activeDetail === 'consumption' ? 'æ¯æ—¥ç®—åŠ›æ¶ˆè€—æ˜ç»†' : 
                                activeDetail === 'shots' ? 'æ¯æ—¥äº§å‡º (æˆ‘ vs é˜Ÿå‹)' : 
                                activeDetail === 'cpr' ? 'æ¯æ—¥ CPR æ•ˆç‡èµ°åŠ¿' : 
                                activeDetail === 'scripts' ? 'å‰§æœ¬æ•ˆç›Šå®¡è®¡é¢æ¿' : 'ä½æ•ˆè­¦å‘Šè®°å½•'
                            }
                            type={activeDetail}
                            data={records}
                            onClose={() => setActiveDetail(null)}
                            baseEfficiency={baseEfficiency}
                        />
                    )}

                    <div className="max-w-6xl mx-auto space-y-8 relative z-10">
                        
                        {/* Header - Relative for absolute positioning of abstract text */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative">
                            {/* Left: Title */}
                            <div>
                                <h1 className="text-3xl md:text-4xl font-black tracking-tighter flex flex-col md:flex-row md:items-center gap-3 drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">
                                    <span className="bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 via-purple-300 to-pink-300 animate-pulse">
                                        Vidu-ai è§†é¢‘æŠ½å¡
                                    </span>
                                    <span className="text-white text-xl md:text-2xl font-bold flex items-center gap-2">
                                        ç§¯åˆ†æ¶ˆè€—è®¡ç®—å¹³å°
                                        <div className="flex flex-col items-start">
                                            <span className="text-xs bg-white/10 text-white px-2 py-0.5 rounded border border-white/20 tracking-widest uppercase backdrop-blur-md">
                                                æ˜“ä¸“å±
                                            </span>
                                            <span className="text-[9px] text-white/40 scale-90 origin-left mt-0.5 tracking-wider font-normal">
                                                å—æ˜Œé…±æ²¹å…¬å¸
                                            </span>
                                        </div>
                                    </span>
                                </h1>
                                <p className="text-white/40 text-sm mt-2 font-medium tracking-wide flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                                    System Online Â· ä¸ƒå½©é«˜æ–¯å¼•æ“æ¸²æŸ“ä¸­
                                </p>
                            </div>

                            {/* Middle: Danger Trigger */}
                            <div 
                                className="hidden lg:flex absolute left-1/2 ml-[113px] top-1/2 -translate-x-1/2 -translate-y-1/2 flex-col items-center justify-center cursor-pointer group z-20 hover:scale-110 transition-transform duration-300"
                                onClick={() => setShowDanger(true)}
                            >
                                {/* Icon bigger: w-20 h-20 (Smaller than w-28, but still big) */}
                                <AlertTriangle className="w-20 h-20 text-red-600 animate-pulse drop-shadow-[0_0_35px_rgba(220,38,38,1)]" />
                                {/* Text below, red, smaller, tight margin */}
                                <span className="text-red-600 font-black text-[10px] tracking-[0.2em] mt-1 bg-black/80 px-4 py-2 rounded border border-red-600/80 backdrop-blur-md shadow-[0_0_15px_rgba(220,38,38,0.6)] whitespace-nowrap opacity-100">
                                    å±é™©ï¼ï¼ç¦æ­¢æ‰“å¼€ï¼ï¼
                                </span>
                            </div>
                            
                            {/* Right: Controls */}
                            <div className="flex items-center gap-3 relative z-10">
                                {/* è¿èƒœç»Ÿè®¡ */}
                                {efficiencyStreak > 0 && (
                                    <div className="hidden md:flex items-center gap-2 bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/30 px-3 py-2 rounded-full backdrop-blur-md animate-[pulse-glow_2s_infinite]">
                                        <Flame className="w-4 h-4 text-orange-400" />
                                        <span className="text-xs font-bold text-orange-200">{efficiencyStreak} Days Efficient</span>
                                    </div>
                                )}

                                {/* å°æ¸¸æˆå…¥å£ */}
                                <button 
                                    onClick={() => setShowGame(true)}
                                    className="bg-white/5 hover:bg-white/10 border border-white/10 p-3 rounded-full transition-all hover:scale-110 hover:shadow-[0_0_15px_rgba(255,255,255,0.3)] group"
                                    title="Play Neural Gacha"
                                >
                                    <Gamepad2 className="w-5 h-5 text-purple-300 group-hover:text-purple-100" />
                                </button>

                                <div className="hidden md:flex gap-4 text-xs font-bold text-white/80 bg-white/5 backdrop-blur-md border border-white/10 px-5 py-3 rounded-full shadow-lg">
                                    <div className="flex items-center gap-2">
                                        <div className="w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_10px_#34d399]"></div>
                                        <span className="text-emerald-300">Target &lt; {baseEfficiency}</span>
                                    </div>
                                    <div className="w-px h-4 bg-white/10"></div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-1.5 h-1.5 rounded-full bg-rose-500 shadow-[0_0_10px_#f43f5e]"></div>
                                        <span className="text-rose-400">Alert &gt; {baseEfficiency}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Stats Overview - 5ä¸ªå¡ç‰‡å¸ƒå±€ */}
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                            {[
                                { id: 'consumption', label: "ç®—åŠ›æ€»æ¶ˆè€—", value: stats.totalConsumed.toLocaleString(), icon: TrendingDown, color: "text-white" },
                                { id: 'shots', label: "æ€»ç”Ÿæˆé•œå¤´", value: stats.totalShots, icon: Users, color: "text-cyan-300" },
                                { id: 'cpr', label: "å¹³å‡ CPR", value: stats.avgCPR, sub: "åˆ†/é•œ", icon: BarChart2, color: parseFloat(stats.avgCPR) > baseEfficiency ? "text-rose-400 drop-shadow-[0_0_8px_rgba(244,63,94,0.6)]" : "text-emerald-400 drop-shadow-[0_0_8px_rgba(52,211,153,0.6)]" },
                                { id: 'inefficiency', label: "ä½æ•ˆè­¦å‘Š", value: stats.inefficiencyCount, icon: AlertTriangle, color: stats.inefficiencyCount > 0 ? "text-rose-500" : "text-emerald-500" },
                                { id: 'scripts', label: "æ´»è·ƒå‰§æœ¬", value: stats.uniqueScripts, icon: Clapperboard, color: "text-indigo-400", sub: "Projects" }
                            ].map((item, idx) => (
                                <Card key={idx} onClick={() => setActiveDetail(item.id)} className="group">
                                    <div className="text-white/40 text-[10px] uppercase tracking-widest font-bold mb-3 flex items-center justify-between">
                                        <div className="flex items-center gap-2"><item.icon className="w-3.5 h-3.5" /> {item.label}</div>
                                        <ChevronRight className="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity" />
                                    </div>
                                    <div className={`text-2xl md:text-3xl font-mono font-bold ${item.color}`}>
                                        {item.value}
                                    </div>
                                    {item.sub && <div className="text-[10px] text-white/20 mt-1 font-medium">{item.sub}</div>}
                                </Card>
                            ))}
                        </div>

                        {/* Input Section */}
                        <Card className="!bg-white/5 !border-white/10 shadow-[0_0_50px_-20px_rgba(255,255,255,0.1)]">
                            <div className="flex flex-col gap-6">
                                <div className="flex justify-between items-center border-b border-white/5 pb-4">
                                    <h2 className="text-lg font-bold text-white flex items-center gap-2">
                                        <PlusCircle className="w-5 h-5 text-cyan-400" />
                                        æ•°æ®å½•å…¥ç»ˆç«¯
                                    </h2>
                                    {lastRecord && (
                                        <span className="text-xs font-mono font-bold text-cyan-200/70 bg-white/5 px-3 py-1.5 rounded border border-white/10">
                                            LAST: {lastRecord.remaining}
                                        </span>
                                    )}
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-12 gap-5 items-end">
                                    {/* Toggle */}
                                    <div className="md:col-span-12 flex items-center gap-3 mb-1">
                                        <label className="group flex items-center gap-3 cursor-pointer select-none">
                                            <div className={`w-12 h-6 rounded-full p-1 transition-all duration-300 ${isTopUp ? 'bg-emerald-500/80' : 'bg-white/10'}`} 
                                                onClick={() => setIsTopUp(!isTopUp)}>
                                                <div className={`w-4 h-4 rounded-full bg-white shadow-md transform transition-all duration-300 ${isTopUp ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                            </div>
                                            <span className={`text-xs font-bold uppercase tracking-wide transition-colors ${isTopUp ? 'text-emerald-400' : 'text-slate-500 group-hover:text-slate-400'}`}>
                                                {isTopUp ? "RECHARGE MODE" : "AUDIT MODE"}
                                            </span>
                                        </label>
                                    </div>
                                    
                                    {/* Date */}
                                    <div className="md:col-span-3 relative group">
                                        <label className="block text-[10px] font-bold text-white/30 mb-2 uppercase tracking-wider ml-1 group-focus-within:text-white transition-colors">Date</label>
                                        <input type="date" value={dateStr} onChange={(e) => setDateStr(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/10 focus:outline-none focus:border-white/30 focus:bg-black/40 transition-all font-mono text-lg" />
                                    </div>

                                    {/* Balance */}
                                    <div className="md:col-span-3 relative group">
                                        <label className="block text-[10px] font-bold text-white/30 mb-2 uppercase tracking-wider ml-1 group-focus-within:text-white transition-colors">Balance</label>
                                        <input type="number" value={remainingPoints} onChange={(e) => setRemainingPoints(e.target.value)} placeholder="0" className="w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/10 focus:outline-none focus:border-white/30 focus:bg-black/40 transition-all font-mono text-lg" />
                                    </div>

                                    {/* Script Name (æ–°å¢å‰§æœ¬åå­—è¾“å…¥) */}
                                    <div className="md:col-span-6 relative group">
                                        <label className="block text-[10px] font-bold text-white/30 mb-2 uppercase tracking-wider ml-1 group-focus-within:text-indigo-400 transition-colors">Script Name (å‰§æœ¬)</label>
                                        <input type="text" value={scriptName} onChange={(e) => setScriptName(e.target.value)} placeholder="e.g. Star Wars V" disabled={isTopUp} className={`w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/10 focus:outline-none focus:border-indigo-500/50 focus:bg-black/40 transition-all font-mono text-lg ${isTopUp ? 'opacity-20 cursor-not-allowed' : ''}`} />
                                    </div>

                                    {/* My Shots */}
                                    <div className="md:col-span-4 relative group">
                                        <label className="block text-[10px] font-bold text-white/30 mb-2 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors">My Shots</label>
                                        <input type="number" value={myShots} onChange={(e) => setMyShots(e.target.value)} placeholder="Me" disabled={isTopUp} className={`w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/10 focus:outline-none focus:border-cyan-500/50 focus:bg-black/40 transition-all font-mono text-lg ${isTopUp ? 'opacity-20 cursor-not-allowed' : ''}`} />
                                    </div>

                                    {/* Partner Shots */}
                                    <div className="md:col-span-4 relative group">
                                        <label className="block text-[10px] font-bold text-white/30 mb-2 uppercase tracking-wider ml-1 group-focus-within:text-pink-400 transition-colors">Partner</label>
                                        <input type="number" value={partnerShots} onChange={(e) => setPartnerShots(e.target.value)} placeholder="Ta" disabled={isTopUp} className={`w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-white/10 focus:outline-none focus:border-pink-500/50 focus:bg-black/40 transition-all font-mono text-lg ${isTopUp ? 'opacity-20 cursor-not-allowed' : ''}`} />
                                    </div>

                                    {/* Button */}
                                    <div className="md:col-span-4">
                                        <button onClick={handleAdd} disabled={!remainingPoints} className="w-full h-[52px] bg-white/10 hover:bg-white/20 disabled:bg-black/20 disabled:text-white/20 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-all border border-white/10 active:scale-95 flex items-center justify-center gap-2 group">
                                            <Save className="w-4 h-4 group-hover:scale-110 transition-transform" />
                                            <span>COMMIT</span>
                                        </button>
                                    </div>
                                </div>

                                {/* Preview */}
                                {!isTopUp && previewConsumption !== null && (
                                    <div className={`mt-2 rounded-lg p-4 text-center border backdrop-blur-md transition-all animate-pulse ${previewConsumption > triggerThreshold && previewCPR > baseEfficiency ? 'bg-rose-500/10 border-rose-500/20' : 'bg-white/5 border-white/10'}`}>
                                        <div className="flex justify-center items-center gap-8">
                                            <div><span className="text-white/30 text-[10px] uppercase font-bold tracking-widest block mb-1">Cost</span><div className={`font-mono font-bold text-xl text-white`}>{previewConsumption}</div></div>
                                            {previewCPR && (<>
                                                <div className="w-px h-8 bg-white/10"></div>
                                                <div><span className="text-white/30 text-[10px] uppercase font-bold tracking-widest block mb-1">CPR</span><div className={`font-mono font-bold text-xl flex items-center gap-1 ${parseFloat(previewCPR) > baseEfficiency ? 'text-rose-400' : 'text-emerald-400'}`}>{previewCPR}</div></div>
                                            </>)}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </Card>

                        {/* History List */}
                        <div className="space-y-5">
                            <div className="flex justify-between items-end px-2 border-b border-white/5 pb-2">
                                <h2 className="text-lg font-bold text-white flex items-center gap-2">
                                    <History className="w-4 h-4 text-cyan-500" />
                                    LOGS
                                </h2>
                                <div className="flex gap-3">
                                    <button onClick={exportData} className="flex items-center gap-1 text-[10px] font-bold text-white/40 hover:text-cyan-400 transition-colors uppercase tracking-wider">
                                        <Download className="w-3 h-3" /> Export
                                    </button>
                                    <button onClick={clearAll} className="text-[10px] font-bold text-white/40 hover:text-rose-400 transition-colors uppercase tracking-wider">
                                        Clear Data
                                    </button>
                                </div>
                            </div>

                            <div className="space-y-3">
                                {records.length === 0 ? (
                                    <div className="text-center py-16 text-white/20 bg-white/5 rounded-lg border border-dashed border-white/10"><p className="font-mono text-sm">NO DATA DETECTED</p></div>
                                ) : (
                                    records.map((record) => (
                                        <div key={record.id} className={`group relative backdrop-blur-md bg-white/5 border border-white/5 hover:bg-white/10 rounded-lg p-4 transition-all duration-300 hover:border-white/10 ${record.isInefficient ? 'shadow-[inset_2px_0_0_0_#f43f5e]' : record.type === 'topup' ? 'shadow-[inset_2px_0_0_0_#10b981]' : 'shadow-[inset_2px_0_0_0_#6366f1]'}`}>
                                            <div className="flex justify-between items-center">
                                                <div className="flex flex-col gap-2">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-white/60 text-xs font-mono">{record.date}</span>
                                                        {record.type === 'topup' && <Badge type="success">RECHARGE</Badge>}
                                                        {record.type === 'initial' && <Badge type="neutral">INIT</Badge>}
                                                        {record.isInefficient && <Badge type="danger">INEFFICIENT</Badge>}
                                                        {/* æ˜¾ç¤ºå‰§æœ¬åå­— */}
                                                        {record.scriptName && <Badge type="script">{record.scriptName}</Badge>}
                                                    </div>
                                                    <div className="flex items-center gap-4 md:gap-8 mt-1">
                                                        <div className="flex flex-col"><span className="text-[10px] text-white/20 uppercase font-bold">Balance</span><span className="text-white/80 font-mono">{record.remaining}</span></div>
                                                        {record.type === 'normal' && (
                                                            <>
                                                                <div className="w-px h-6 bg-white/5"></div>
                                                                <div className="flex flex-col"><span className="text-[10px] text-white/20 uppercase font-bold">Cost</span><span className="text-white font-bold font-mono">{record.consumed}</span></div>
                                                                <div className="w-px h-6 bg-white/5"></div>
                                                                <div className="flex flex-col">
                                                                    <span className="text-[10px] text-white/20 uppercase font-bold">Shots</span>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-cyan-300 font-mono">{record.shots}</span>
                                                                        {(record.myShots !== undefined || record.partnerShots !== undefined) && (<span className="text-[10px] text-white/30 font-mono">{record.myShots}+{record.partnerShots}</span>)}
                                                                    </div>
                                                                </div>
                                                                {record.shots > 0 && (
                                                                    <div className={`ml-auto hidden md:flex flex-col items-end px-3 py-1 rounded border ${parseFloat(record.cpr) > baseEfficiency ? 'bg-rose-500/10 border-rose-500/20' : 'bg-emerald-500/10 border-emerald-500/20'}`}>
                                                                        <span className={`text-[10px] uppercase font-bold ${parseFloat(record.cpr) > baseEfficiency ? 'text-rose-500' : 'text-emerald-500'}`}>CPR</span>
                                                                        <span className={`font-mono text-sm ${parseFloat(record.cpr) > baseEfficiency ? 'text-rose-300' : 'text-emerald-300'}`}>{record.cpr}</span>
                                                                    </div>
                                                                )}
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                    <button onClick={() => setEditingRecord(record)} className="p-2 text-white/20 hover:text-cyan-400 hover:bg-white/5 rounded transition-all"><Edit2 className="w-4 h-4" /></button>
                                                    <button onClick={() => handleDelete(record.id)} className="p-2 text-white/20 hover:text-rose-500 hover:bg-white/5 rounded transition-all"><Trash2 className="w-4 h-4" /></button>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
